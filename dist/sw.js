const CACHE_NAME="png-metadata-extractor-v1",LOCAL_ASSETS=["./","./index.html","./manifest.json"],EXTERNAL_ASSETS=["https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css","https://cdn.jsdelivr.net/npm/jsnview/build/index.css","https://cdn.jsdelivr.net/npm/jsnview/build/index.min.js"];self.addEventListener("install",e=>{console.log("[Service Worker] インストール中..."),e.waitUntil(caches.open(CACHE_NAME).then(e=>(console.log("[Service Worker] キャッシュを作成中..."),e.addAll(LOCAL_ASSETS).then(()=>Promise.allSettled(EXTERNAL_ASSETS.map(t=>fetch(t,{mode:"cors"}).then(n=>{if(n.ok)return e.put(t,n)}).catch(e=>{console.warn(`[Service Worker] 外部リソースのキャッシュに失敗: ${t}`,e)})))))).then(()=>(console.log("[Service Worker] インストール完了"),self.skipWaiting())))}),self.addEventListener("activate",e=>{console.log("[Service Worker] アクティベート中..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>e!==CACHE_NAME).map(e=>(console.log(`[Service Worker] 古いキャッシュを削除: ${e}`),caches.delete(e))))).then(()=>(console.log("[Service Worker] アクティベート完了"),self.clients.claim())))}),self.addEventListener("fetch",e=>{const t=e.request;"GET"===t.method&&e.respondWith(caches.match(t).then(e=>e||fetch(t).then(e=>{if(e&&200===e.status){const n=e.clone();caches.open(CACHE_NAME).then(e=>{e.put(t,n)})}return e}).catch(e=>{console.error("[Service Worker] フェッチエラー:",e)})))});